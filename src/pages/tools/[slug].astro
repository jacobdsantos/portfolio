---
import AppShell from '../../design-system/components/AppShell.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const allTools = await getCollection('tools');
  return allTools.map(entry => ({
    params: { slug: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const tool = entry.data;

const statusConfig: Record<string, { color: string; dot: string; label: string }> = {
  'Production': { color: 'text-accent-primary', dot: 'bg-accent-primary', label: 'Production' },
  'Active Dev': { color: 'text-accent-warning', dot: 'bg-accent-warning', label: 'Active Development' },
  'Planned': { color: 'text-text-muted', dot: 'bg-text-muted', label: 'Planned' },
};

const status = statusConfig[tool.status] || statusConfig['Planned'];

const toolAccents = [
  { bg: 'bg-accent-primary/10', border: 'border-accent-primary/20', text: 'text-accent-primary', gradient: 'from-accent-primary/20 to-accent-primary/5' },
  { bg: 'bg-violet-500/10', border: 'border-violet-500/20', text: 'text-violet-400', gradient: 'from-violet-500/20 to-violet-500/5' },
  { bg: 'bg-rose-500/10', border: 'border-rose-500/20', text: 'text-rose-400', gradient: 'from-rose-500/20 to-rose-500/5' },
  { bg: 'bg-cyan-500/10', border: 'border-cyan-500/20', text: 'text-cyan-400', gradient: 'from-cyan-500/20 to-cyan-500/5' },
  { bg: 'bg-amber-500/10', border: 'border-amber-500/20', text: 'text-amber-400', gradient: 'from-amber-500/20 to-amber-500/5' },
  { bg: 'bg-emerald-500/10', border: 'border-emerald-500/20', text: 'text-emerald-400', gradient: 'from-emerald-500/20 to-emerald-500/5' },
];

const toolIcons: Record<string, string> = {
  'TITAs': `<svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"/></svg>`,
  'Skadi': `<svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"/></svg>`,
  'SPOT Report Engine': `<svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg>`,
  'Confluence Tools Suite': `<svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M11.42 15.17l-5.63 3.29a.75.75 0 01-1.1-.66V5.65a.75.75 0 011.1-.66l5.63 3.29m0 0l5.63-3.29a.75.75 0 011.1.66v12.15a.75.75 0 01-1.1.66l-5.63-3.29m0 0V3.75m0 11.42V20.25"/></svg>`,
  'OpenCTI MCP Server': `<svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"/></svg>`,
  'Claude Code Desktop': `<svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M6.75 7.5l3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0021 18V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v12a2.25 2.25 0 002.25 2.25z"/></svg>`,
  'Obsidian MCP': `<svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/></svg>`,
  'ImageGen MCP': `<svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909M2.25 18V6a2.25 2.25 0 012.25-2.25h15A2.25 2.25 0 0121.75 6v12A2.25 2.25 0 0119.5 20.25h-15A2.25 2.25 0 012.25 18z"/></svg>`,
};

const defaultIcon = `<svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M11.42 15.17l-5.63 3.29a.75.75 0 01-1.1-.66V5.65a.75.75 0 011.1-.66l5.63 3.29"/></svg>`;

// Pick accent by tool order
const accentIdx = (tool.order ?? 0) % toolAccents.length;
const accent = toolAccents[accentIdx];

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": tool.name,
  "alternateName": tool.fullName,
  "description": tool.description,
  "applicationCategory": "SecurityApplication",
  "operatingSystem": "Cross-platform",
  "author": {
    "@type": "Person",
    "name": "Jacob Santos",
    "jobTitle": "Senior Threat Researcher"
  },
  "url": `https://jacobsantos.pages.dev/tools/${entry.id}`,
};
---

<AppShell
  title={`${tool.name} - ${tool.fullName}`}
  description={tool.description}
  jsonLd={jsonLd}
  breadcrumbs={[
    { label: 'Home', href: '/' },
    { label: 'Tools', href: '/tools' },
    { label: tool.name },
  ]}
>
  <!-- Hero -->
  <div class={`relative rounded-2xl overflow-hidden bg-gradient-to-br ${accent.gradient} mb-8`}>
    <div class="absolute inset-0" style="background-image: linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px); background-size: 24px 24px;"></div>
    <div class="absolute inset-0 flex items-center justify-center text-white/10">
      <Fragment set:html={toolIcons[tool.name] || defaultIcon} />
    </div>
    <div class="absolute bottom-0 left-0 right-0 h-24 bg-gradient-to-t from-bg-primary to-transparent"></div>

    <div class="relative p-6 md:p-10 pt-16 md:pt-24">
      <div class="flex items-center gap-2 mb-4">
        <span class={`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-black/40 backdrop-blur-sm text-[11px] font-mono ${status.color} border border-white/10`}>
          <span class={`w-1.5 h-1.5 rounded-full ${status.dot}`}></span>
          {status.label}
        </span>
      </div>
      <h1 class="text-2xl md:text-3xl font-bold text-text-primary tracking-tight">
        {tool.name}
      </h1>
      <p class="text-text-secondary text-sm font-mono mt-1">{tool.fullName}</p>
    </div>
  </div>

  <!-- Content -->
  <div class="content-card mb-6">
    <!-- Description -->
    <div class="mb-6">
      <p class="text-text-secondary text-sm leading-relaxed">
        {tool.description}
      </p>
    </div>

    <!-- Impact -->
    <div class="flex items-start gap-3 mb-6 p-4 rounded-xl bg-accent-primary/[0.04] border border-accent-primary/[0.08]">
      <svg class="w-5 h-5 text-accent-primary shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
      </svg>
      <div>
        <h2 class="text-text-primary text-sm font-semibold mb-1">Impact</h2>
        <p class="text-text-secondary text-sm">{tool.impact}</p>
      </div>
    </div>

    <!-- Tech Stack -->
    <div class="mb-6">
      <h2 class="text-text-muted text-[10px] uppercase tracking-widest font-mono mb-3">Technology Stack</h2>
      <div class="flex flex-wrap gap-1.5">
        {tool.tech.map(t => (
          <span class="tag-cyan">{t}</span>
        ))}
      </div>
    </div>

    <!-- Divider -->
    <div class="border-t border-white/[0.06] my-6"></div>

    <!-- Back link -->
    <a
      href="/tools"
      class="inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-bg-surface border border-white/[0.06] text-text-muted text-sm font-medium hover:text-text-primary hover:border-white/10 transition-all"
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
      </svg>
      Back to Tools
    </a>
  </div>
</AppShell>
