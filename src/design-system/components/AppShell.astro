---
import '../../styles/global.css';
import Header from './Header.astro';
import SidebarNav from './SidebarNav.astro';
import Footer from './Footer.astro';

interface Props {
  title?: string;
  description?: string;
  canonical?: string;
  ogImage?: string;
  jsonLd?: object;
  breadcrumbs?: Array<{label: string; href?: string}>;
}

const {
  title = 'Jacob Santos â€” Senior Threat Researcher',
  description = 'Senior threat researcher specializing in ransomware analysis, security automation, and intelligence dissemination.',
  canonical,
  ogImage,
  jsonLd,
  breadcrumbs,
} = Astro.props;

const siteUrl = 'https://jacobsantos.pages.dev';
const fullTitle = title.includes('Jacob Santos') ? title : `${title} | Jacob Santos`;
const canonicalUrl = canonical || new URL(Astro.url.pathname, siteUrl).href;
const ogImageUrl = ogImage || '/og/default.png';
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <meta name="description" content={description} />
    <meta name="author" content="Jacob Santos" />
    <meta name="keywords" content="threat researcher, ransomware, cybersecurity, threat intelligence, malware analysis, Trend AI, MITRE ATT&CK, security automation, APT, BYOVD" />
    <meta name="theme-color" content="#08090e" />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(ogImageUrl, siteUrl).href} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:site_name" content="Jacob Santos" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={fullTitle} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={new URL(ogImageUrl, siteUrl).href} />

    <!-- Canonical -->
    <link rel="canonical" href={canonicalUrl} />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <title>{fullTitle}</title>

    <!-- JSON-LD Structured Data -->
    {jsonLd && (
      <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
    )}
  </head>
  <body class="min-h-screen">
    <!-- Animated mesh background -->
    <div class="mesh-bg" aria-hidden="true">
      <div class="mesh-orb mesh-orb-1"></div>
      <div class="mesh-orb mesh-orb-2"></div>
      <div class="mesh-orb mesh-orb-3"></div>
    </div>

    <!-- Skip to main content link for accessibility -->
    <a
      href="#main-content"
      class="fixed top-0 left-0 z-[100] px-4 py-2 bg-accent-primary text-bg-primary font-semibold text-sm rounded-br-xl transform -translate-y-full focus:translate-y-0 transition-transform duration-200"
    >
      Skip to main content
    </a>

    <div class="min-h-screen flex flex-col">
      <!-- Header (top nav bar) -->
      <Header />

      <!-- Mobile profile strip (visible below lg breakpoint) -->
      <div class="lg:hidden px-4 pt-4 md:px-6 md:pt-6">
        <div class="max-w-[1200px] mx-auto">
          <div class="mobile-profile-card">
            <!-- Top row: photo + identity + socials -->
            <div class="flex items-center gap-4">
              <!-- Photo -->
              <div class="relative shrink-0">
                <div class="absolute -inset-0.5 rounded-2xl bg-gradient-to-br from-accent-primary/20 via-accent-secondary/10 to-accent-tertiary/20 blur-[2px]"></div>
                <img
                  src="/images/profile.jpg"
                  alt="Jacob Santos"
                  class="relative w-16 h-16 sm:w-20 sm:h-20 object-cover object-top rounded-2xl border border-white/[0.08]"
                  loading="eager"
                />
              </div>
              <!-- Identity -->
              <div class="flex-1 min-w-0">
                <h2 class="text-lg font-semibold text-text-primary tracking-tight font-display leading-tight">Jacob Santos</h2>
                <p class="text-text-muted text-[11px] mt-0.5 leading-relaxed">Threat researcher. Tool builder. Intelligence dissemination.</p>
                <div class="inline-flex items-center gap-1.5 mt-2 px-2.5 py-1 rounded-lg bg-accent-primary/[0.06] border border-accent-primary/10 text-[10px] font-mono text-accent-primary">
                  <span class="relative flex h-1.5 w-1.5">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-accent-primary opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-1.5 w-1.5 bg-accent-primary"></span>
                  </span>
                  Sr. Threat Researcher
                </div>
              </div>
            </div>

            <!-- Stats row -->
            <div class="grid grid-cols-4 gap-2 mt-4">
              <div class="text-center py-2 rounded-xl bg-bg-surface/50 border border-white/[0.04]">
                <div class="text-sm font-bold text-accent-primary font-mono">17</div>
                <div class="text-text-muted text-[8px] uppercase tracking-widest">Articles</div>
              </div>
              <div class="text-center py-2 rounded-xl bg-bg-surface/50 border border-white/[0.04]">
                <div class="text-sm font-bold text-accent-secondary font-mono">14</div>
                <div class="text-text-muted text-[8px] uppercase tracking-widest">Threads</div>
              </div>
              <div class="text-center py-2 rounded-xl bg-bg-surface/50 border border-white/[0.04]">
                <div class="text-sm font-bold text-accent-tertiary font-mono">10+</div>
                <div class="text-text-muted text-[8px] uppercase tracking-widest">Tools</div>
              </div>
              <div class="text-center py-2 rounded-xl bg-bg-surface/50 border border-white/[0.04]">
                <div class="text-sm font-bold text-accent-danger font-mono">10+</div>
                <div class="text-text-muted text-[8px] uppercase tracking-widest">Talks</div>
              </div>
            </div>

            <!-- Quick links row -->
            <div class="flex items-center gap-2 mt-3">
              <a href="mailto:jacobsantos.d@gmail.com" class="mobile-social-btn" title="Email">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75"/></svg>
              </a>
              <a href="https://www.linkedin.com/in/jacob-santos-046313198/" target="_blank" rel="noopener" class="mobile-social-btn" title="LinkedIn">
                <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
              </a>
              <a href="https://github.com/jacobdsantos" target="_blank" rel="noopener" class="mobile-social-btn" title="GitHub">
                <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
              </a>
              <div class="flex-1"></div>
              <a href="/resume" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-accent-primary/[0.08] border border-accent-primary/15 text-accent-primary text-[10px] font-medium hover:bg-accent-primary/15 transition-all">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                Resume
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="flex-1 p-4 md:p-6 lg:p-10">
        <div class="max-w-[1200px] mx-auto flex flex-col lg:flex-row gap-6">
          <!-- Sidebar (desktop only) -->
          <aside class="hidden lg:block lg:w-[320px] lg:shrink-0">
            <div class="lg:sticky lg:top-6">
              <SidebarNav />
            </div>
          </aside>

          <!-- Main content area -->
          <main id="main-content" class="flex-1 min-w-0">
            <!-- Breadcrumbs -->
            {breadcrumbs && breadcrumbs.length > 0 && (
              <nav aria-label="Breadcrumb" class="mb-4">
                <ol class="flex items-center gap-1.5 text-xs font-mono text-text-muted">
                  {breadcrumbs.map((crumb, idx) => (
                    <li class="flex items-center gap-1.5">
                      {idx > 0 && (
                        <svg class="w-3 h-3 text-text-muted/40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                        </svg>
                      )}
                      {crumb.href ? (
                        <a href={crumb.href} class="hover:text-accent-primary transition-colors">{crumb.label}</a>
                      ) : (
                        <span class="text-text-secondary">{crumb.label}</span>
                      )}
                    </li>
                  ))}
                </ol>
              </nav>
            )}

            <slot />
          </main>
        </div>
      </div>

      <!-- Footer -->
      <Footer />
    </div>

    <!-- Command palette keyboard listener + scroll reveal -->
    <script>
      // Cmd+K search
      document.addEventListener('keydown', (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
          e.preventDefault();
          const searchInput = document.getElementById('cmd-search');
          if (searchInput) {
            searchInput.focus();
          }
        }
      });

      // Scroll-triggered reveal animations
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const revealElements = document.querySelectorAll('[data-reveal]');

      if (prefersReducedMotion) {
        revealElements.forEach(el => el.classList.add('revealed'));
      } else if (revealElements.length > 0) {
        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                entry.target.classList.add('revealed');
                observer.unobserve(entry.target);
              }
            });
          },
          { rootMargin: '0px 0px -60px 0px', threshold: 0.1 }
        );
        revealElements.forEach(el => observer.observe(el));
      }
    </script>
  </body>
</html>
